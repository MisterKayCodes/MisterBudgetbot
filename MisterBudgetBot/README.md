# Mister Budget - Telegram Budget Management Bot

A comprehensive Telegram bot built with aiogram v3 to help users manage their finances, track expenses and income, set savings goals, and get personalized financial advice.

## Features

### Core Features
- **Onboarding**: Simple registration with name and email collection
- **Income Management**: 
  - Add income with automatic splitting across accounts (Spending/Savings/Business)
  - View income history
  - See goal allocations when adding income (for goals with auto-save enabled)
- **Expense Tracking**: 
  - Log expenses with categories (Food, Transport, Bills, Shopping, etc.)
  - View recent expense history
  - Track expenses by category
- **Savings Goals**: 
  - Create goals with target amounts and optional deadlines
  - Set auto-save percentage to automatically allocate income to goals
  - Track goal progress with visual indicators
  - View all active and completed goals
- **Accounts Management**: View balances across Spending, Savings, and Business accounts
- **Financial Advisor**: 
  - Spending analysis with breakdown by category
  - Savings rate analysis and goal progress tracking
  - Smart recommendations based on your financial habits
  - Top spending category identification
- **Reports & Summaries**: 
  - Weekly summary (last 7 days)
  - Monthly summary (last 30 days)
  - All-time statistics
  - CSV export of all transactions
  - Category breakdown for expenses
- **Reminders**: 
  - Toggle daily reminder notifications on/off
  - Toggle weekly summary reports on/off
  - Persistent reminder preferences
- **Settings**:
  - Change currency (NGN, USD, EUR)
  - Adjust income split percentages
  - Customizable account distribution

### Subscription Features
- **Subscription Status**: View current subscription plan and expiration
- **Trial Codes**: Redeem trial codes for free access periods (generated by admin)
- **Payment Information**: View pricing and payment address (configured in config.py)

**Note**: The bot currently does NOT have in-app payment submission or approval. Users who want paid subscriptions should:
1. Make payment to the configured payment address
2. Contact admin directly via Telegram with payment proof
3. Admin manually creates subscription record in the database using SQL

### Admin Features
- **Subscription Management**: Toggle subscription mode on/off globally to enable or disable subscription requirements
- **Trial Code Generation**: Generate unique trial codes with custom duration (1-365 days) for promotional access
- **Subscriber Management**: View comprehensive list of all active subscribers including:
  - Full name and email
  - Current plan type (trial, paid, etc.)
  - Subscription start and expiration dates
- **Bot Statistics Dashboard**: 
  - Total registered users
  - Active subscribers count
  - Total transactions processed
  - Active savings goals across all users
- **Secure Access**: Admin panel accessible only via `/admin` command for authorized Telegram user IDs

**Note on Subscription Activation**: The bot does NOT currently have in-app payment approval functionality. To manually activate a user's subscription after they've made payment:

1. **Verify payment** through your external payment system
2. **Backup the database** (recommended before manual edits):
   ```bash
   cp data/mister_budget.db data/mister_budget_backup.db
   ```

3. **Get the user's ID** from the database:
   ```bash
   sqlite3 data/mister_budget.db
   ```
   Then in the SQLite prompt:
   ```sql
   SELECT id, telegram_id, full_name, email FROM users WHERE full_name LIKE '%UserName%';
   ```
   Note the `id` value (not telegram_id) for the next step.

4. **Insert a subscription record**:
   ```sql
   INSERT INTO subscriptions (user_id, plan_type, start_date, end_date, status, payment_method, created_at)
   VALUES (123, 'paid', '2025-01-01 00:00:00', '2025-02-01 00:00:00', 'active', 'manual', '2025-01-01 00:00:00');
   ```
   Replace:
   - `123` with the actual user_id from step 3
   - Dates with appropriate start and end dates (end_date determines subscription length)
   
5. **Exit the database**: Type `.exit` in the SQLite prompt

6. **Alternative method**: Generate and share a trial code for temporary access (no database access needed)

### Advanced Features
- **Multi-Currency Support**: NGN (â‚¦), USD ($), EUR (â‚¬)
- **Customizable Income Splits**: Configure percentage distribution for Spending/Savings/Business
- **Auto-Save Goals**: Automatically allocate percentage of income to active goals
- **Dynamic Main Menu**: Shows real-time balance, monthly expenses, savings, and goal count

## Technology Stack

- **Python 3.11+**
- **aiogram v3.4.1** - Telegram Bot framework
- **aiosqlite 0.19.0** - Async SQLite database
- **APScheduler 3.10.4** - Task scheduling for reminders
- **pandas 2.1.4** - Data export functionality
- **python-dotenv 1.0.0** - Environment variable management

## Project Structure

```
MisterBudget/
â”œâ”€â”€ bot.py                  # Main entry point
â”œâ”€â”€ config.py               # Configuration and constants
â”œâ”€â”€ database.py             # Database setup and initialization
â”œâ”€â”€ main_menu.py            # Main menu logic
â”œâ”€â”€ requirements.txt        # Python dependencies
â”‚
â”œâ”€â”€ data/                   # Database and migrations
â”œâ”€â”€ utils/                  # Utility functions (formatters, helpers, logger)
â”œâ”€â”€ states/                 # Global FSM states
â”œâ”€â”€ database_models/        # Database model functions
â”‚
â”œâ”€â”€ features/               # Feature modules
â”‚   â”œâ”€â”€ start/             # Onboarding flow
â”‚   â”œâ”€â”€ income/            # Income management
â”‚   â”œâ”€â”€ expense/           # Expense tracking
â”‚   â”œâ”€â”€ goals/             # Savings goals
â”‚   â”œâ”€â”€ summary/           # Reports and summaries
â”‚   â”œâ”€â”€ advisor/           # Financial advisor
â”‚   â”œâ”€â”€ settings/          # User settings
â”‚   â”œâ”€â”€ accounts/          # Account management
â”‚   â”œâ”€â”€ reminders/         # Reminder system
â”‚   â”œâ”€â”€ subscription/      # Subscription management
â”‚   â””â”€â”€ admin/             # Admin panel
â”‚
â””â”€â”€ scheduler/             # Scheduled tasks
```

## Setup Instructions

### 1. Clone or Access the Project

This project is already set up in your Replit environment.

### 2. Environment Variables

The following secrets are already configured in Replit Secrets:

- `TELEGRAM_BOT_TOKEN` - Your Telegram bot token from @BotFather
- `ADMIN_IDS` - Comma-separated list of Telegram user IDs for admin access

To get your Telegram user ID, message [@userinfobot](https://t.me/userinfobot) on Telegram.

### 3. Dependencies

All Python dependencies are already installed via `requirements.txt`:

```bash
aiogram==3.4.1
aiosqlite==0.19.0
APScheduler==3.10.4
pandas==2.1.4
python-dotenv==1.0.0
```

### 4. Run the Bot

The bot is configured to run automatically. You can also start it manually:

```bash
python bot.py
```

## Usage Guide

### For Users

1. **Start the bot**: Send `/start` to your bot on Telegram
2. **Provide your details**: Enter your full name and email
3. **Main Menu**: Access all features through inline buttons

#### Income Management
- Click "â• Add Income"
- Enter the amount
- Bot automatically splits it based on your configured percentages (default: 60% Spending, 20% Savings, 20% Business)
- If you have active goals with auto-save enabled, you'll see how much goes to each goal

#### Expense Tracking
- Click "â– Add Expense"
- Enter the description
- Enter the amount
- Select a category from the list
- Expenses are automatically deducted from your Spending account

#### Savings Goals
- Click "ğŸ¯ My Goals" â†’ "â• Create New Goal"
- Enter goal name (e.g., "New Laptop", "Emergency Fund")
- Enter target amount
- (Optional) Set a deadline
- (Optional) Set auto-save percentage to automatically allocate income
- View progress for all your goals with completion percentages

#### Financial Reports
- Click "ğŸ“Š Summary"
- Choose Weekly, Monthly, or All-Time report
- See income vs expenses, category breakdown, and net savings
- Export all your transactions as CSV for detailed analysis

#### Financial Advisor
- Click "ğŸ§  Advisor"
- View spending analysis by category
- Check your savings rate and goal progress
- Get smart recommendations to improve your finances

#### Settings
- Click "âš™ï¸ Settings"
- Change your preferred currency
- Adjust income split percentages (must total 100%)
- View current configuration

#### Reminders
- Click "ğŸ—“ï¸ Reminders"
- Toggle daily reminder notifications
- Toggle weekly summary reports
- Preferences are saved automatically

#### View Accounts
- Click "ğŸ’¼ Accounts"
- See balances for Spending, Savings, and Business accounts
- View total balance across all accounts

### For Admins

1. **Access Admin Panel**: Send `/admin` command (only works if your Telegram ID is in ADMIN_IDS)

2. **Toggle Subscription Mode**: 
   - Click "ğŸ” Toggle Subscription Mode"
   - Enable to require subscriptions for bot access
   - Disable for free access to all users

3. **Generate Trial Codes**: 
   - Click "ğŸŸï¸ Generate Trial Code"
   - Enter duration in days (1-365)
   - Share the generated code with users
   - Users can redeem codes via Subscription menu

4. **View Subscribers**: 
   - Click "ğŸ“‹ View Subscribers"
   - See list of active subscribers with:
     - Full name
     - Email
     - Plan type
     - Expiration date

5. **Bot Statistics**: 
   - Click "ğŸ“Š Bot Statistics"
   - View total users, active subscribers, total transactions, and active goals


## Default Configuration

- **Default Currency**: NGN (â‚¦)
- **Default Income Split**:
  - Spending: 60%
  - Savings: 20%
  - Business: 20%
- **Supported Currencies**: NGN, USD, EUR

## Database Schema

The bot uses SQLite with the following main tables:

- `users` - User profiles and preferences
- `accounts` - User account balances (Spending, Savings, Business)
- `transactions` - Income and expense records
- `goals` - Savings goals with progress tracking
- `reminders` - User reminder preferences
- `subscriptions` - User subscription records
- `trial_codes` - Trial code management
- `pending_payments` - Manual payment submissions
- `admin_settings` - Global admin configuration

## Customization

### Change Default Split Percentages

Edit `config.py`:

```python
DEFAULT_SPENDING_PERCENT = 60
DEFAULT_SAVINGS_PERCENT = 20
DEFAULT_BUSINESS_PERCENT = 20
```

### Add More Currencies

Edit `config.py`:

```python
CURRENCY_SYMBOLS = {
    "NGN": "â‚¦",
    "USD": "$",
    "EUR": "â‚¬",
    "GBP": "Â£"  # Add new currency
}
```

## Completed Features

All major features have been implemented and are ready to use:

âœ… Complete onboarding flow
âœ… Income management with automatic splitting
âœ… Expense tracking with categories
âœ… Savings goals with auto-save
âœ… Financial advisor with insights and recommendations
âœ… Weekly, monthly, and all-time summaries
âœ… CSV export functionality
âœ… Reminders system (daily and weekly)
âœ… Settings management (currency, split percentages)
âœ… Subscription system with trial codes (manual payment activation via database)
âœ… Complete admin panel (statistics, trial codes, subscriber viewing)
âœ… Multi-currency support
âœ… Goal allocation display when adding income

## Potential Future Enhancements

High Priority:
- **In-app payment submission and approval workflow** (currently requires manual database updates)
- **Automated payment webhook integration** for instant subscription activation

Other Enhancements:
- Advanced financial advisor with ML-based predictions
- Recurring transactions automation
- Budget limits and alerts
- Multi-language support
- Mobile app integration
- Bank account integration via API
- Investment tracking
- Bill payment reminders

## Troubleshooting

### Bot not responding
1. Check if the workflow is running
2. Verify bot token is correct in Secrets
3. Check logs for errors: See workflow console output

### Database issues
1. Database is automatically created on first run
2. Located at `data/mister_budget.db`
3. Delete database file to reset (will lose all data)

### Admin access not working
1. Verify your Telegram ID is in ADMIN_IDS secret
2. Format: Comma-separated numbers (e.g., "123456789,987654321")
3. Restart bot after updating secrets

## Contributing

This is a personal finance management bot. Feel free to extend features:

1. Add new handlers in `features/` directory
2. Create corresponding keyboards, services, and states
3. Register router in `bot.py`
4. Test thoroughly before deployment

## License

Private project for personal use.

## Support

For issues or questions:
- Check the code documentation
- Review Telegram Bot API docs: https://core.telegram.org/bots/api
- Check aiogram documentation: https://docs.aiogram.dev/

---

**Built with â¤ï¸ by MrKay**
